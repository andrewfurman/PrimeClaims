
{% include 'templates/header.html' %}

<div class="container mx-auto px-4 py-8 max-w-7xl">
    <div class="mb-8">
        <h1 class="text-2xl font-bold mb-2">Claim ID: {{ claim.claim_id }}</h1>
        <h2 class="text-xl mb-6">
            Member: 
            <a href="{{ url_for('members.view_member', member_id=claim.member.member_id) }}" 
               class="text-blue-600 hover:text-blue-800 hover:underline">
                {{ claim.member.first_name }} {{ claim.member.last_name }} - {{ claim.member.member_id }}
            </a>
        </h2>
    </div>
    
    <form id="editClaimForm" class="space-y-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- Drug Information -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-lg font-semibold mb-4 text-blue-600">Drug Information</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Drug Name</label>
                        <input type="text" name="drug_name" value="{{ claim.drug_name }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Drug Strength</label>
                        <input type="text" name="drug_strength" value="{{ claim.drug_strength }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Drug Form</label>
                        <input type="text" name="drug_form" value="{{ claim.drug_form }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">NDC Number</label>
                        <input type="text" name="ndc_number" value="{{ claim.ndc_number }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                </div>
            </div>

            <!-- Prescription Details -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-lg font-semibold mb-4 text-blue-600">Prescription Details</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Quantity Dispensed</label>
                        <input type="number" name="quantity_dispensed" value="{{ claim.quantity_dispensed }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Days Supply</label>
                        <input type="number" name="days_supply" value="{{ claim.days_supply }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Fill Number</label>
                        <input type="number" name="fill_number" value="{{ claim.fill_number }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Date Prescription Written</label>
                        <input type="date" name="date_prescription_written" value="{{ claim.date_prescription_written }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                </div>
            </div>

            <!-- Pricing Information -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-lg font-semibold mb-4 text-blue-600">Pricing Information</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Ingredient Cost</label>
                        <input type="number" step="0.01" name="ingredient_cost_submitted" value="{{ claim.ingredient_cost_submitted }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Dispensing Fee</label>
                        <input type="number" step="0.01" name="dispensing_fee_submitted" value="{{ claim.dispensing_fee_submitted }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Patient Paid Amount</label>
                        <input type="number" step="0.01" name="patient_paid_amount_submitted" value="{{ claim.patient_paid_amount_submitted }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Usual and Customary Charge</label>
                        <input type="number" step="0.01" name="usual_and_customary_charge" value="{{ claim.usual_and_customary_charge }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                </div>
            </div>

            <!-- Prescriber Information -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-lg font-semibold mb-4 text-blue-600">Prescriber Information</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Prescriber ID</label>
                        <input type="text" name="prescriber_id" value="{{ claim.prescriber_id }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Prescriber Last Name</label>
                        <input type="text" name="prescriber_last_name" value="{{ claim.prescriber_last_name }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Prescriber Phone</label>
                        <input type="text" name="prescriber_phone_number" value="{{ claim.prescriber_phone_number }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                </div>
            </div>

            <!-- Service Provider Information -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-lg font-semibold mb-4 text-blue-600">Service Provider</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Provider ID</label>
                        <input type="text" name="service_provider_id" value="{{ claim.service_provider_id }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Provider ID Qualifier</label>
                        <input type="text" name="service_provider_id_qualifier" value="{{ claim.service_provider_id_qualifier }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                </div>
            </div>

            <!-- Clinical Information -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-lg font-semibold mb-4 text-blue-600">Clinical Information</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Diagnosis Code</label>
                        <input type="text" name="diagnosis_code" value="{{ claim.diagnosis_code }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Clinical Information</label>
                        <textarea name="clinical_information" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" rows="3">{{ claim.clinical_information }}</textarea>
                    </div>
                </div>
            </div>

            <!-- Additional Information -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-lg font-semibold mb-4 text-blue-600">Additional Information</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Place of Service</label>
                        <input type="text" name="place_of_service" value="{{ claim.place_of_service }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Pharmacy Service Type</label>
                        <input type="text" name="pharmacy_service_type" value="{{ claim.pharmacy_service_type }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Patient Residence Code</label>
                        <input type="text" name="patient_residence_code" value="{{ claim.patient_residence_code }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                    </div>
                </div>
            </div>
        </div>

        <div class="flex justify-end mt-8">
            <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                Save Changes
            </button>
        </div>
    </form>
</div>

<script>
document.getElementById('editClaimForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const button = e.target.querySelector('button[type="submit"]');
    button.disabled = true;
    button.innerHTML = 'Saving...';
    
    try {
        const response = await fetch(window.location.href, {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            window.location.reload();
        } else {
            alert('Error updating claim: ' + result.error);
        }
    } catch (error) {
        alert('Error updating claim: ' + error);
    } finally {
        button.disabled = false;
        button.innerHTML = 'Save Changes';
    }
});
</script>
